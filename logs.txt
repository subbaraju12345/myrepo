- aws logs put-metric-filter --log-group-name $LOG_GROUP --filter-name AuthorizationFailures --filter-pattern '{($.errorCode = "*UnauthorizedOperation") || ($.errorCode = "AccessDenied*") }' --metric-transformations metricName=AuthorizationFailureCount,metricNamespace=CloudTrailMetrics,metricValue=1
- aws cloudwatch put-metric-alarm --alarm-name AuthorizationFailureCount --metric-name AuthorizationFailureCount --namespace CloudTrailMetrics --statistic Sum --comparison-operator GreaterThanOrEqualToThreshold --evaluation-periods 1 --period 300 --threshold 1 --actions-enabled --alarm-actions $sns_arn
- aws logs put-metric-filter --log-group-name $LOG_GROUP --filter-name ConsoleSignInWithoutMfa --filter-pattern '{ $.eventName = "ConsoleLogin" && $.additionalEventData.MFAUsed != "Yes" }' --metric-transformations metricName=ConsoleSignInWithoutMfaCount,metricNamespace=CloudTrailMetrics,metricValue=1 
- aws cloudwatch put-metric-alarm --alarm-name ConsoleSignInWithoutMfaCount --metric-name ConsoleSignInWithoutMfaCount --namespace CloudTrailMetrics --statistic Sum --comparison-operator GreaterThanOrEqualToThreshold --evaluation-periods 1 --period 300 --threshold 1 --actions-enabled --alarm-actions $sns_arn
- aws logs put-metric-filter --log-group-name $LOG_GROUP --filter-name IAMPolicyChanges --filter-pattern '{($.eventName=DeleteGroupPolicy)||($.eventName=DeleteRolePolicy)||($.eventName=DeleteUserPolicy)||($.eventName=PutGroupPolicy)||($.eventName=PutRolePolicy)||($.eventName=PutUserPolicy)||($.eventName=CreatePolicy)||($.eventName=DeletePolicy)||($.eventName=CreatePolicyVersion)||($.eventName=DeletePolicyVersion)||($.eventName=AttachRolePolicy)||($.eventName=DetachRolePolicy)||($.eventName=AttachUserPolicy)||($.eventName=DetachUserPolicy)||($.eventName=AttachGroupPolicy)||($.eventName=DetachGroupPolicy)}' --metric-transformations metricName=IAMPolicyChangesEventCount,metricNamespace=CloudTrailMetrics,metricValue=1
- aws cloudwatch put-metric-alarm --alarm-name IAMPolicyChangesEventCount --metric-name IAMPolicyChangesEventCount --namespace CloudTrailMetrics --statistic Sum --comparison-operator GreaterThanOrEqualToThreshold --evaluation-periods 1 --period 300 --threshold 1 --actions-enabled --alarm-actions $sns_arn
- aws logs put-metric-filter --log-group-name $LOG_GROUP --filter-name CloudTrailChanges --filter-pattern '{ ($.eventName = CreateTrail) || ($.eventName = UpdateTrail) || ($.eventName = DeleteTrail) || ($.eventName = StartLogging) || ($.eventName = StopLogging) }' --metric-transformations metricName=CloudTrailChangesEventCount,metricNamespace=CloudTrailMetrics,metricValue=1
- aws cloudwatch put-metric-alarm --alarm-name CloudTrailChangesEventCount --metric-name CloudTrailChangesEventCount --namespace CloudTrailMetrics --statistic Sum --comparison-operator GreaterThanOrEqualToThreshold --evaluation-periods 1 --period 300 --threshold 1 --actions-enabled --alarm-actions $sns_arn
- aws logs put-metric-filter --log-group-name $LOG_GROUP --filter-name ConsoleSignInFailures --filter-pattern '{ ($.eventName = ConsoleLogin) && ($.errorMessage ="Failed authentication") }' --metric-transformations metricName=ConsoleSignInFailuresCount,metricNamespace=CloudTrailMetrics,metricValue=1
- aws cloudwatch put-metric-alarm --alarm-name ConsoleSignInFailuresCount --metric-name ConsoleSignInFailuresCount --namespace CloudTrailMetrics --statistic Sum --comparison-operator GreaterThanOrEqualToThreshold --evaluation-periods 1 --period 300 --threshold 1 --actions-enabled --alarm-actions $sns_arn
- aws logs put-metric-filter --log-group-name $LOG_GROUP --filter-name disable_or_delete_cmk_changes_metric --filter-pattern '{($.eventSource = kms.amazonaws.com) &&(($.eventName=DisableKey)||($.eventName=ScheduleKeyDeletion)) }' --metric-transformations metricName=disable_or_delete_cmk_changes_metricCount,metricNamespace=CloudTrailMetrics,metricValue=1
- aws cloudwatch put-metric-alarm --alarm-name disable_or_delete_cmk_changes_metricCount --metric-name disable_or_delete_cmk_changes_metricCount --namespace CloudTrailMetrics --statistic Sum --comparison-operator GreaterThanOrEqualToThreshold --evaluation-periods 1 --period 300 --threshold 1 --actions-enabled --alarm-actions $sns_arn
- aws logs put-metric-filter --log-group-name $LOG_GROUP --filter-name S3BucketActivity --filter-pattern '{ ($.eventSource = s3.amazonaws.com) && (($.eventName = PutBucketAcl) || ($.eventName = PutBucketPolicy) || ($.eventName = PutBucketCors) || ($.eventName = PutBucketLifecycle) || ($.eventName = PutBucketReplication) || ($.eventName = DeleteBucketPolicy) || ($.eventName = DeleteBucketCors) || ($.eventName = DeleteBucketLifecycle) || ($.eventName = DeleteBucketReplication)) }' --metric-transformations metricName=S3BucketActivityEventCount,metricNamespace=CloudTrailMetrics,metricValue=1
- aws cloudwatch put-metric-alarm --alarm-name S3BucketActivityEventCount --metric-name S3BucketActivityEventCount --namespace CloudTrailMetrics --statistic Sum --comparison-operator GreaterThanOrEqualToThreshold --evaluation-periods 1 --period 300 --threshold 1 --actions-enabled --alarm-actions $sns_arn
- aws logs put-metric-filter --log-group-name $LOG_GROUP --filter-name AWSConfigChange --filter-pattern  '{($.eventSource = config.amazonaws.com) && (($.eventName=StopConfigurationRecorder)||($.eventName=DeleteDeliveryChannel)||($.eventName=PutDeliveryChannel)||($.eventName=PutConfigurationRecorder))}' --metric-transformations metricName=AWSConfigChanges,metricNamespace=CloudTrailMetrics,metricValue=1
- aws cloudwatch put-metric-alarm --alarm-name AWSConfigChangesAlarmEventCount --metric-name AWSConfigChanges --namespace CloudTrailMetrics --statistic Sum --comparison-operator GreaterThanOrEqualToThreshold --evaluation-periods 1 --period 300 --threshold 1 --actions-enabled --alarm-actions $sns_arn
